# SAML/OIDC Test Application
This is an application used to test SAML and OIDC authentication.  Code has been created with the assistance of an AI coding agent.

# Requirements
* An application that has a main page that displays login buttons for a user to log in using one of the configure identify providers.
* The application can use React javascript framework.
* A protected page that can only be accessed when the user provides a valid access credential.
* Valid access credentials include valid SAML assertions or JWT tokens.
* The protected page should display the information contained in the access credential provide by the user.
* The application should be able to handle multiple identity providers (IdPs)
* SAML assertions coming from the IdP should have the signature checked against a list of known certificate signers.
* JWT tokens coming from the IdP should have the signature checked against a list of known certificate signers.
* The application should have a folder that stores all the configuration data for the application.
* In the data folder there should be a subfolder for all certificates that the application trusts for the purpose of access credential signing.
* In the data folder there should be a config.json file
* The config.json file should have an array of identity providers.
  * Each element in the array represents a single IdP.
  * Each IdP will have a 'protocol' value that should be either "saml20" or "oidc"
  * For saml20 IdPs, the array element should have values for:
    * Application name
    * login url
    * logout url
    * certificate to trust for SAML assertions for that IdP
  * For oidc IdPs, the array element should have values for:
    * Application name
    * Tenant URL
    * Issuer URL
    * authorication URL
    * token URL
    * user info URL
    * metadata URL
    * client ID
    * client secret
    * callback URL
    * scope
  * For each element in the array, the main application page should display a login button with the IdP name.
* The SAML metadata file generated by this application should include:
  * The AssertionConsumerService binding, which is the HTTPS protocol, the FQDN of the application, and the /assert path.  Since this is just a sample app, we'll always just use /assert as the path.
  * The certificate used to sign the SAML request
  * The certificate used to encrypt the SAML request.

# Major components in this application
* Frontend web site.
* Backend web site.  The  backend website will include these major endpoints:
  * /assert - This will receive SAML responses from all IdPs
  * /callback - This will receive OIDC responses from all IdPs
* SAML private key and certificate for the application to sign SAML request before they are sent to the IdP.
* SAML private key and certificate for the application to encrypt SAML request before they are sent to the IdP.
* Web server private key and certificate.
* A data directory that holds:
  * config.json which is the configuration file for the application.
  * certsAndKeys directory which holds the private keys and certificates for the SAML signing and web server.
  * certificates directory which holds all the certificates and certificate chains the application will trust for incoming SAML responses


# Configuration options for the application
The config.json file will hold these configuration options for the application.
* The FQDN of the application.  Use this FQDN instead of hard coding anything like "localhost"
* The filename of the SAML signing certificate for the application.
* The filename of the SAML signing private key for the application.
* Whether or not the outgoing SAML requests should be signed.
* An array of all the identity providers the application can communicate with.  See the section on Configuration options per IdP for information on each IdP configuration.
* There will not be a need to declare the OIDC callback URL for the application, since that will always be FQDN + /callback
* There will not be a need to declare the SAML assertionConsumerServiceUrl since that will always been the FQDN + /assert



# Configuration options per IdP
The following are configuration options that may vary between IdPs, and therefore each IdP must have parameters indicating what the application should do.
* The name of the application.
* The protocol to use, whether saml20 or oidc.
* The login URL which is the URL the user will be redirected to for SAML or OIDC authentication.
* The logout URL which is the URL the user will be redirected to for SAML or OIDC authentication.
* The certificate that will be used by the identity provider to sign SAML responses
* The private key that will be used to decrypt SAML repsonses from the identity provider.
* The scope for OIDC authentication
* The client id for OIDC authentication
* The client secret for OIDC authentication
* The tenant URL for the OIDC identity provider
* The issuer URL for the OIDC identity provider
* The authorization URL for the OIDC identity provider
* The token URL for the OIDC identity provider
* The userinfo URL for the OIDC identity provider
* The metadata URL for the OIDC identity provider
* There will not be a need to declare the OIDC callback URL for the application, since that will always be FQDN + /callback
* There will not be a need to declare the SAML assertionConsumerServiceUrl since that will always been the FQDN + /assert




# Tests to create
Below is a list of functional tests that must be created:
* Clicking on the metadata download link on the front page will download a file called "metadata.xml" which will contain the SAML metadata for the application.

# Things to remember
* When building container images, tell the build process not to use any caches so that there are no issues with cached data.
* When adding a feature, always build the tests first and run them to ensure they all fail.  This ensures the tests will detect any failures.  Then build the code and ensure all the tests pass.

